# -*- coding: utf-8 -*-
"""Untitled13.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1bLSi-BRgqW4g-ZSetxFVpCJffSlmiK94
"""

import pandas as pd
import numpy as np

parquet_file='/content/train.parquet'

train_data=pd.read_parquet(parquet_file)

train_data.shape

train_data["Date"] = pd.to_datetime(train_data["Date"] )

new_data = train_data.drop_duplicates()
new_data = new_data.loc[~new_data.index.duplicated(), :]

new_data['Period'] = new_data.groupby(["Patient-Uid","Incident"])["Date"].diff().abs()
new_data.dropna()

df=(new_data[new_data["Period"]<"40 days"])
df

#df.isna()

#df=df[pd.notnull(df['Period'])]

#df_mode=df.groupby(["Patient-Uid","Incident"])["Period"].aggregate(pd.Series.mode).to_frame()

#df_mode.head(10)

df['Period'] = df['Period'].dt.days.astype('int32')

df.head()

type(df['Period'])

df['op']=df['Period'].apply(lambda x: 1 if x >= 28 and x <= 32 else 0)
 df

df.shape

df_mode=df.groupby(["Patient-Uid","Incident"])["op"].aggregate(pd.Series.mode).to_frame()

df_mode.head(10)

"""def query_count(df_mode):
    return df_mode.query('op' == 1).op.count()
print(query_count(df_mode))
"""

print(type(df_mode['op']))

count=0
for i in df_mode['op']:
  if i==1:
    count+=1
print(count)

#df.sort_values(by=['Country'])

df_code=df_mode.sort_values(by=['Patient-Uid'])
df_code

df_

df_mode['Patient_code'] = df_mode['Patient-Uid'].cat.codes
df_mode.head()

pd.get_dummies(df_mode, columns=['Patient-Uid']).head()